<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>新增履歷</title>
</head>
<body>
<h3>填寫履歷</h3>

	<form id="insert" enctype="multipart/form-data">
	
		刊登編號 <input type="hidden" name="rackid"><br>
		會員編號 <input type="text" name="uid" value='2' required><br>
		應徵職缺 <input type="text" name="work" required><br>
		姓名 <input type="text" name="name" required><br>
		年次 <input type="text" name="age" required><br>
		性別 <input type="text" name="gender" required><br>
		email <input type="text" name="mail" required><br>
		電話 <input type="text" name="phone" required><br>
		學歷<textarea name="educational" cols="20" rows="5"></textarea><br>
		經歷<textarea name="experience" cols="20" rows="5"></textarea><br>

		<input id="send" type="button" value="送出"><br>
		<input type="reset" value="取消"><br>
	</form>
	
	<form action="/morari/guest/work/workGuest.controller" method="GET"
		enctype="multipart/form-data">
		<input type="submit" value="回首頁">
	</form>
	<hr>
	
	<h3 id="su"></h3>
	<table id="showInsert"></table>

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
	<script type="text/javascript">
		$(document).ready(function () {
			$("#send").click(function () {
				function getFormData($form) {
					var unindexed_array = $form.serializeArray();
					var indexed_array = {};

					$.map(unindexed_array, function (n, i) {
						indexed_array[n['name']] = n['value'];
					});
					console.log(indexed_array);
					return indexed_array;
				}
				var url = window.location.href;
				var id = url.split("/").pop();
				console.log(id);
				$.ajax({
					type: 'POST',
					url: '/morari/guest/work/resumeInsert.controller/'+id,
					contentType: 'application/json',
					data: JSON.stringify(getFormData($("#insert"))),
					success: function (response) {
						$('#showInsert').empty("");
						$('#su').empty("");
						$('#insert').empty("");
						console.log(response);
						if (response == null) {
							$('table').prepend("<tr><td colspan='2'>暫無資料</td></tr>");
						} else {
							var h3 = $('#su');
							h3.prepend('成功送出');
							var table = $('#showInsert');
							table.append("<tr><th>會員編號</th><th>應徵職缺</th><th>姓名</th><th>年次</th><th>性別</th><th>email</th><th>電話</th><th>學歷</th><th>經歷</th></tr>");

						
							//$.each(response, function (i,n) { i=index 第幾個 n=element 元素
								console.log("response:"+response);
								var tr = "<tr align='center'>" + "<td>" + response.userprofiles.uid +"</td>"+"<td>" + response.work + "</td>" + "<td>" + response.name + "</td>" + "<td>" + response.age + "</td>" +
									"<td>" + response.gender + "</td>" + "<td>" + response.mail + "</td>" + "<td>" + response.phone + "</td>" + "<td>" + response.educational + "</td>" + 
									"<td>" + response.experience + "</td>" +"</tr>";
								table.append(tr);
							//});
						}
					}
				});
			});
		});
	</script>
</body>
</html>